{% extends 'archives/base.html' %}
{% load widget_tweaks %}

{% block title %}录入新档案{% endblock %}

{% block content %}
<div class="container">
    <h1 class="my-4">录入新档案</h1>
    
    <form method="post">
        {% csrf_token %}
        
        <div class="card mb-4">
            <div class="card-header">档案信息</div>
            <div class="card-body">
                {{ form.title.label_tag }}
                {{ form.title|add_class:"form-control" }}
                
                {{ form.description.label_tag }}
                {{ form.description|add_class:"form-control" }}
                
                {{ form.copy_count.label_tag }}
                {{ form.copy_count|add_class:"form-control" }}
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">存放位置</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        {{ form.archive_room.label_tag }}
                        {{ form.archive_room|add_class:"form-control" }}
                    </div>
                    <div class="col-md-6">
                        {{ form.cabinet.label_tag }}
                        {{ form.cabinet|add_class:"form-control" }}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        {{ form.side.label_tag }}
                        {{ form.side|add_class:"form-control" }}
                    </div>
                    <div class="col-md-4">
                        {{ form.row.label_tag }}
                        {{ form.row|add_class:"form-control" }}
                    </div>
                    <div class="col-md-4">
                        {{ form.column.label_tag }}
                        {{ form.column|add_class:"form-control" }}
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">档案盒与特殊情况</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        {{ form.box.label_tag }}
                        {{ form.box|add_class:"form-control" }}  <!-- 添加档案盒选择字段 -->
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            {{ form.is_special }}
                            {{ form.is_special.label_tag }}
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-check">
                            <input type="checkbox" id="create_new_box" class="form-check-input">
                            <label for="create_new_box" class="form-check-label">创建新的档案盒</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <button type="submit" class="btn btn-primary">保存档案</button>
            <a href="{% url 'home' %}" class="btn btn-secondary">取消</a>
        </div>
    </form>
</div>

<script>
    document.getElementById('create_new_box').addEventListener('change', function() {
        const boxField = document.getElementById('id_box');
        if (this.checked) {
            boxField.value = '';  // 清空选择的档案盒
            boxField.disabled = true;  // 禁用档案盒选择
        } else {
            boxField.disabled = false;  // 启用档案盒选择
        }
    });
</script>
{% endblock %}